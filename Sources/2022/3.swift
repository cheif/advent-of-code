import Shared

public func day3() {
//    print(part1(input: input))
    print(part2(input: input))
}

private func part1(input: String) -> Int {
    let rucksacks = input.split(whereSeparator: \.isNewline).map {
        ($0.prefix($0.count/2), $0.dropFirst($0.count/2))
    }
    let sharedItems = rucksacks.map { firstCompartment, secondCompartment in
        Set(firstCompartment.filter(secondCompartment.contains))
    }
    let priorities = sharedItems.compactMap { $0.map(value(for:)).sum }
    return priorities.sum
}

private func part2(input: String) -> Int {
    let rucksacks = input.split(whereSeparator: \.isNewline)
    let groups = rucksacks.chunked(into: 3)
    let badges = groups.map { rucksacks in
        Set(rucksacks[0].filter { rucksacks[1].contains($0) && rucksacks[2].contains($0) })
    }
    return badges.flatMap { $0.map(value(for: )) }.sum
}

private func value(for char: Character) -> Int {
    let ascii = Int(char.asciiValue!)
    return char.isLowercase ? ascii - 96 : ascii - 38
}

private let test = """
vJrwpWtwJgWrhcsFMMfFFhFp
jqHRNqRjqzjGDLGLrsFMfFZSrLrFZsSL
PmmdzqPrVvPwwTWBwg
wMqvLMZHhHMvwLHjbvcjnnSBnvTQFn
ttgJtRGJQctTZtZT
CrZsJsPPZsGzwwsLwLmpwMDw
"""

private let input = """
wgqJtbJMqZVTwWPZZT
LHcTGHQhzrTzBsZFPHFZWFFs
RnLRClzGzRGLGLGCNRjTMjJfgmffSffMqNgp
WPLgsfLmLgqZvZgSRR
RbwHdbDdQFFFMvvMjbhqhZZS
lzTdldBDszfGcRsr
ZjnhJjMjnbdnbHdFLmmfFLmnCCWFFl
PpNwtRsNsZSsRwCfzQQBfQszCBsC
PpwcqqVZRtbggggjcgJJ
ntczBcVcgnHzgBHnVntcBBFhgsmmmssqWNWNWqLvNhsqTN
bSSGdSDZbGSGdDmLmGTvTGmLFFhm
PlFbDpJDPbPdPbZQZDZlSCDBfMVRwBzBtBQzfzRHVMVRtH
fDVrmmrvcmCcVpfcfGlswpPwsttMpjJMPPjjtP
RgSTdndFLbJqqPssWWjPWjPjHS
FqgzQnTqJRRQqLLhTCDhDCDmcmlvvlhcVm
nnqVtHbfVHZVmtlvmHtZtrFSFTRRFhRccTbrLsLSGr
cCNJQJPJQgjjMQdDrGGsRhTFGFRFSpMS
gzdCwWdjNPgzcJgjwdZtVlHHmvvmZlvffHnz
FFgsgwNwWvggQsMWDwvQQvQcccdcJZDtJGBtVGGGtcVlzt
rjfTrbjpjRSRTbTpzldjjHBtJGBdltJG
RbrPTfpCfmbpmnfRRCvMvQWNBwFFgMsgBL
zzLHgjjjdFHWbGBjjzcbgQRmSvqsSpmRsRSQSmRMWv
ZfJVrwPhZhZlhQQqBSQSNSqM
tnCfrDCltfPzHFFLBgngHz
DCpwrrMhwCrCMVCpGFqpVDnWWTWBtnTWvWfvbbTdFWRv
lmhhcsQPmTtTnnPBTB
QmcjNJsJzHNljZsNqDCGGhwqCqhgDDZV
hLfRnSLfhcndCCPfJJjzJfzt
pHNWwDpGGNJBZjjNNj
gmgwwHpWTpmGDmDTggqHmmDSsnnhvcqScdVVSVcjLrRcnq
CdlTJgnQJVCllNVWTPZBmPPGhGRmghPRGs
wHDrSwtHbmhRvHVZ
DzzwrtVFjLNnMTCTLCWW
SppdsnGpNVnZZZLPMlMPGq
mdcfvTTbBddLJgZJLlcFqJ
fzTvfwjjfzzCbvvjvQjWvNHVNNVWrRtdnVNppNprDp
lmlCGTmNbZlbSFlbNGfnzWfWzCdWWfVdwRCf
jDHtHHvLjQtqrsqpjBBLprRzwfwJfzzhRnczhWQVwzVR
rqpPtpPjDqpqDLtLrPGGFSFgPlNZZSGMPnMZ
pSHShqgSMzVpphFnJMFMBtssdjRJ
PZDbZfmCDgDfDNQPwCflCQNJsjRBRBFsdBWBsJRjsbsFJF
DQvCwwZrPPlffDmQCDwZQPmPhqVTcGhSHSLTpSGhLHzpGghr
gPqgqqmmmPgsqvGmsMCCnfZZfvBpWZhVrrZdHBvH
TSlcttTjRTDlDDTRhZVdrHHpWVnfVrtd
SFJzFzcJjcRJwGGqJMMCwW
gzWNLSjRLzlNqqQMLhvQccGGmcQm
fFrttPdTFTrpVwGpbdVQQp
HnTBGfHTGzWWqCqngn
SddrLdVpjjVSgRBszFswzwlV
mtPMbMqPMvqHHHDTTglBvsFshFFg
bmBHbtPctMtbMNMtbPtPqHmMjpdZdcJGrjSWWZGjJZnjndWj
nljWJHRHGrDcMBbDLZHV
wdvwmhghhbtBMcLtwZ
gvQvvghTfPSmpmQljGFRjQbFGCsJbC
BmphBWmDBBQfpVgQZpjg
rqqGrrrqlnqqHqjNnVDSSSgQQffj
FqLrbsLFsbLbLqHlMrmwwPDcCmMMmJBwDJcC
wZccfslqZPFFjrFbFfQQ
vvTvVWCJJZVBWCSvnVJJrhjQVMjVjzbgMQbjpphh
BBmNWBvZRvSqwsGwssPcmc
LGpnfcnzfzQdNFNHqHJptq
RBNNvZSBRbRCCDJqHrDZqHFZtw
SRNhRsNhWSNWsRRvgjngQnnMTnTgQjGMff
twtZmwqBHtmqnnmlGLfcfvQQ
dgMSPSMdQGclRRdF
pVMrDgThDDlPWPWbBZtZqqttBqjqjT
PPSWCGSzpCCQwNsNPFhTNVbB
vqcgJngqLLcZLvBhNTVlbsvdFF
DDmHgRjHZhHtGfWpQH
sBLbwWWBvsBsqLqStRjcGGRnggjGcntJDn
NCMQPMQPMQNzGGRRgRJRGzcG
dHQNfPCFTQfFfVVNvwwJvSWSqWqrSqdS
prDBnnDpFDprnDPBDQBvpBZttcSqSZSZcScFJSHcZJtz
VhMVdLsjdqVWJSWZZZcHst
hLVdGLfqjGjlfhCfCLjTTmrlpQBPBmvnrgDgpp
SSSTJmmgbGwtmRZHCCZRCH
FWcPQrrWqflzSWpRHZCZHRSt
PSQzzdcQTghdndDJ
cLlrNPvljRhRgTlM
VmDBGnVdmJDnDBndnnVwDRvMgRsTbTzMMsgZghzzsB
SpHvmGnSDJnwvDQqfrCPLpPLCfpF
PppbRCCgpzzQCgCSgZTlNNTWnNNDNlRnGl
hwMhLtBcBdjjNzWzlclcNGTs
FjJFHJwhfwLHMLJLwPmqfQPgVCmQgCmCzC
jTtMqFjMBqBmTntTztBTnTZBRZRLpLJgDgJNhghJrNNhhLJh
DCDdvdGsVDVsflVdQSsfSwhRJlgppgpRpbWLgJbJpgbR
wfSHSsdSVvQSwfwQPQPqHtFDcMzmtjBntqMTqn
HQhQWLCSHCSCjnjQdSJdCSQgTTmZPTVZmqnTpPtnpmRmpp
vDrzhvGzfchvlGvMFMrqVqPgZVVtZtVRgZgm
bcvMfwvDsDfbvfwDbbdhCShWCBLLJWjHsHjj
zLSsJNCjsjLCNLCgGcwBPPdwBwqwqz
WMFZprZDbrddWRVRRDvlPPBcPhhlBqqHPGPhhffg
VdbFvZWWWZZDFTLtCmNntjTnLSnn
JLVhhwRbhVwcLFJFhhJcccqwsvpRlllvpWvZSBSSSRsNWpzl
jgzfPffgZNspgZQS
fjCmDCGnfmTfFqrFnhqbFzqt
SfMRRNHSNNLfRfHcRRsqwdCCsssTqBCvgBLv
llDDWQnFGtQnmtGQDWQFsgdHVBddndHsgqTsCTsg
GzGjpWmWbmQmbpGGmGjHSrZcMfZSRPJPfcMRcb
PDdMdRTRrLDSwzJvfSvJ
FnjQnsqsFTnStvplhhzzFS
TBHHCsgVRRcMHbLR
GcLdGBJvBvLJHccJBvqHpGzDFfzwfzjwhDwrSFpfpDSn
mZZrTTQVmQmlsMPVblZQVZmfCwjzzjChzCCbDSzhFjfnSb
gZlRlZNPlmlgTTPmNRvJWcqrNLdvHWLBcHtH
jWWbBwgwWwwtvvSCtHvgWsMFmscHzTGMmcssGFTTGz
ZrLtpLnlfQJqnfJtpLnZlrqdNNGqcDNNFFTNDzzMMTMsMNMs
LJQrnZnfLZnlrZflJJRVRQbbwBgCtCVjWgjBjjgbPjBB
fqQVfRqSqmpnlLnm
jFcjMJTjhwwggjFtgzCHmCzCmGzGlzpn
wstMFFjWDfQRvmDPSB
PgTFGPgcBZPcHPFBZRjGPgwCnmwCsmSdQdThmMMMQCQS
JbpvWtvfHblWDHJDzmndSdMQnSwCdhMdQD
rfvWlLlbtfJvvLJpqWbbqZRRGPVFNHVFgZNVFBgH
TRMrrGBLMLPtbssTGtBHwZmdQQbdNzzZZNZZdwjd
CVlVhCnclvhWSFFfQrWNrjmpNfwmjZ
rlqFlclChhCvnlDvgVvRRtPtqTGJHRMBRTPPqM
gZzCrQGQdrQvZHPTHWDbTgWPJM
nSpLlcnnVjsSVLLnLSnhLSsJPTTWFsqfbPMFMqJDbfqM
VwwnpwLnlPdQCwPPCC
lRlrnlrsrMlhVsRnVhGPvCFNcPBDBvccrCGr
RZQTzWTRdDNvBDdNcC
TqjZbWRHmlMJgnmsng
scQmLfQBQQvvZfLsmmvDJwpgSNSDDdcJSSwTGD
PHlMbtzCCnlbztMRzlPNNdNwGpDpwgwptNLGpw
rRHnLbhCzbbCHnHjMbzzjzFZmfQqWZQqvmhmfVZmqFBW
fLTQWTMQtjcCGCJCbf
gGsmsVSzmjCFHJCJgg
SPRsSwSvBsPRPsqzwSVqzmhVWtLWhTDNLlTDtLTWGpNMtDLt
mbzRbchRRQzzssLdhLggLddJ
DCqDNNNWvDvjcPLsJcLLdv
cpFCVNnVBHtbfFRtMRFf
PFRcCCPtsDDDtjVspgwmgTNpTgTpspsw
BqqqdJdHdMgSfMmZpZND
vDHJGdLbLzBJdGnDdrBqVtCzWPPhthtPFzzPCFtV
HvhvHdFdvJDfHdZdpfhrmGPljPRrGPPVDGrWWC
NMMsRBMzcRRMMBSzcnbmNGrCVCWrCqPClmPqlG
zLBbwMzQnRSQMThtZFLvpdgHtJfF
DpcJcJPmMcLSHHZCfpnH
BsBFvvqTFlbhgdbBBblfZLCLzfHWfjnjLCnCrh
dTsNgqFvNgsGlZJRtVtMPmtDmG
LdGQqzPGCCjJTJdTLJQJtFcFRSctcrFNFltPFtcc
HphMMbbMdBMHbBhhgHMnhvwFFvtrlSNRNgcRllcvcc
spHMhBnHnnsmWdnsnMBMdVGGmzjzLmZLDQCCCCZjqjTD
DDZMzcTRgDMLzqCffhfWfcWnfj
NsHVVJmswwSSwNPPNjnhqhnCCnhNvjfTnv
rSSddrGSGrlMrpTpQT
bbbfCfrLHMMMWVWC
SqsvNZqQvvqcjNvqZsMMwgFgFplTHQVRFgWH
BSZWWqBZBjmPGJGLbBtf
RNCNfzfRHmzHwSdRdGfzRJPqFcFcDFGccZZqtLtGLtgl
pjhVMhvhbjvPcDJvcZqt
bsQMTsjppmSdTnHSJH
PtLwpSwdSJwQnGvvqtvMhZ
TlFcHlTjVjsDTQnCQhbZGCVVnb
cjljTslTrlzzHDNRfNgLSNBJfBwNfG
HvsZZqqqwWZswWHTmHsvvfhSfBfDffjchfBbhD
MCpnCVpQClRNnlNQVQClfDhScmjBfLhmLDGbBNbS
gmtpJpQQllJnWdZWwJWFwJJT
TzBvBwwdhgRPGHlRHh
NLWttJsrLWttppLpsGlsmVbVGRljGDRgjV
MlllnNFnnQqCdzqq
vptzrJhMMGGMptJPhJGJPvdFTFcSsTBVsczBScTSFFfn
gbRjWgRjCqjZnfHCHnTSVBHF
mRwqNbmqlbbjqRNlLbNrDJntNDGtDhNpGMrpvJ
GPWZLgWqLHHGbgbbGPPmqHqfcjjRHJJBDRBRjBBjMHjwvwQc
dhpFSpzVSSMSlDBvMQ
TndsVNztVTspnsdpshtmZLPCGGNPfgqbWWfDGb
CbqDjjCdClqgrfJvrv
NGNPtGGzzHztPWWnlgJvfBnWBFgp
hGzNHhsmGccwHPHZHcwdCCdbTVRTvSmTCjbLCb
sqnqsHGpJbqnrbshpshHmmmCWZZmWwfTjTjHmfLZ
dPggRgSDDttMFgctgdDtDcDcRWJBmjTWwmRLBLfmwBBjZWTB
PFcVPlJPglbqhhrnnlNz
wZdDNDdPPfhqwWqbsF
VTngRzpnzMLvzTCLlhvDfltqqDttqFqs
mggTVpCDDSNjBmPZrd
cSdqJSTTTJcSJpCdQbqTCPPdjdDtGzwzjDwjwwwwzD
rVvsBBVgsVBhHhfljtgbPgGtWjPtwt
fvHsVZHVnRHpSJJRmbbSLT
lDDPRRjwLGlvVRDRPlwwwPvmpSfhVWSzhqfzqpHpVpVHfqSH
qBnqBNsBBChhCSfZ
nTQbQnNNQJTLvlmTPLqqmG
TTCJhDrmDpRVhvhHfffwzwfz
dmmdmglWcqvHvWsHzB
gdQMZbtlgQlZcMSttCNmVVrLSTTJ
PLZLqhZZzZLBjjjGrrPjMH
CcQcCcfRlWDjdrMrBrHC
WlWFMcFpcRFmsWFcmflqSJzTqzwLvshggsZJwz
LgqRDDDHHGTpgpJrQrQhhhCqrwPw
ZSBWjjFshCFlQDrJ
SjWnnbWtWnsztgGDDbDTGgHHGp
llfvMlvzjzGzGRfvMSGRfSdStrCtQNCZrrFdJJLnNtLZ
shhhshPHsTTqsBHTVTwTwZZnCtQrQnJtQCCJBCCZdZ
TPHTPTHmDnljplfpGfGm
qcNTmvvSvTNrWhRrTdthzW
bDVJphpMMJwJpMHtrrttWsgwtzRW
bFpGJbllPfplVQmnhvvcSmCFqq
GTPJGMQTPQMqZjHTBmnndBVddHrrzNrz
bbcRFgDpptRbffwmzmrvLmcZvmLmLv
WCwgWbpgwtgfpfMlQGPhSPZWTZPl
DsPCswsMPBMwPDCVJPnTPPWFGJNJmbJW
RvvddfvftdtvNzghGSbFnWTntJSttGbG
LNgRddgRlgzcgCDjjjHjcBCwcM
gnVtgBnpwBgShBgcwhJJhjCMMMDmLRjDRMjrDMMMDMqMRF
slsblHPNHlbTNbsPvszHQWbzqrZLMRmFMFmdFmrtDFdMLNZD
bPzfvbfsvvlHtlzPHllHGTlTppCJpgcngcpwnwCGGJnnShwV
cgQRgtzDbHPcgHzQWpTjTLdjjNNpNLsDss
nwccZBmwcJqmJnjsTvmlTSsdlTNs
CCGFCBVrBwwGBhqVnZBrqWMMQzHfQcHzzzPtfztGfg
lhnwnhlbgbngbcfDgJLJQqDdVd
FSrvtMFZVJJJVtcq
jZNNNNjmjSPjFTJmGGzswwzHwHpBsbPblhhW
tnDWHntzDtzQBZLMLzNLDDcRFFjhJBmcFRCTjRchcRvT
sqwsPlbGfSbPGSVbJfpjjhcTFmCRjjvmTTvRdw
lJqSqPVbgGSGrVSqJqflbWZQNDMLHnrQQWNDMtQMQz
lpltwwJqsWVLPtVt
DGHsDdZQzHLSLZcFRrFS
BGsGCnHmMlMwCfwT
nrRNzRMPrrPnNwNzTSFSTNtqZdtMttvQqQmjdjvZpgjZ
GWVhGcGhHhGcffbZGDmmtttQvpdtbpppdj
HGlHBhHGJfJJhCfZzLTTNnNrTnCNwT
jBpCZStjBwWrQCMrhw
TvcHBzHdPPzdvFTzzJlvzdQfThrhhrhfQTWMQfWMqfwf
bzGJJBJcJvdvBPFzddGgjZSbZZngRZNNnnsjRs
dqPqbpPFJfsFfMcNQNNtNmzrNQJn
VVBDWvwZWDLwGlDhLGWWVcmQtSNmLmtSdSSTmrcQQm
lZlhwDCdhhHllvWvjMHbgMpgffMggpPb
SWSFLLFWDSWDNFzmmLMfGlfsdfnJMBfwMGVnBf
vPtgZcctcTQQZRRcgCtZwRfqBVGqnVTBGVnqlsdBJnqV
RcjgwbbgNSbFbhDb
JrRZLrHvjQFPLnnBPQ
DhwbtHbzpcpFTgtQ
zlDwlHlzWSwDqhMMbSJVZVvrCrCZJZNZdJ
fgNCZSDtDfDZTrTfqWghQGzGQshgpGGFQg
RFvLnvFjnVjmLQGPQWLmWh
MdwwVMFbMdRHFbccbCZJtbDJrqqJZNJZCZ
fdZVBMMdfdfBCzhTzMdMCgCrGGrpQJmSmGJGmpJQVpLmqV
RbFnhNsvlDsFHttllGmqGpPLvJpmPJSqLL
tjNsDnNwbNjttNNZTzhMWzcZcMTwMd
DjSSMShjRjPCbDFCdCSDbpBBswfNWZBZZrBVBPNfVmVf
zltLjLqqGlzQntqqGztqcgncZrVrmNfNwWBVrVmrgwrfswsW
qcTqHLlnJzGznLJtHGhMbhjFhMMpFbpbThpp
ZVFZcctFQzsCtbZFnPPHqmqpwmvPmp
NrjGfMgcLLcfdLqpmRwRRqJJmdPw
LMNDgMBGlgGDLMNDGljctVbVWZTTCWChhTttsl
RMGRRhhgzgZMtHdGTtvDwDJFCDvvwdvwqFFv
rfrrjLNmmSnSjVSmNNPPbJVbqvqsqvhvFqCq
flrpnSlrSNfjrNjSphNSWlHRGzTgtQGHQtttBTRBRQHW
tplDDprhbvprvrJDprCpbsvHRfzSzTtzmRqSTznRRBRnSfFF
MVwWjVNVQGfcMnTmRnBm
VQwGLNLjWNWPGjZbsDBppBZhhDvBlZ
RVVrGVVchRZsnzRzBWZb
FQHWWCHwQmWmlqfCHSwJnsbNJnNsvttntBtb
QQSFgqgqLMLPPdWdMVhWDT
cZrMjncTdfJpPJbr
WHNqnQwwCwvlqHtCtHNslNlvLLPDfSVdVPVDVSfVSbftffVf
NCwwwQwllwnvgsvZzgzFZzBzjGGGMM
MvHpfzcTcZzpphhbsDSTStsltqSDtS
PRmnwCrWnWQrmNMRNnlNGbqlbDltdlbDtNtD
CRJnmRVWJfgMLvcz
HPFbHrrwLdVdgbDZqcphCqSZBhLZ
tQRfRRGtvTNNSGTMjjmDCRhmqpBChqhsRDZh
vjSfMzGQNQQnMtNTTWNNjgblFdFHwgdJJHHPwddgnr
BggPRVBPPgfCBmJTjTTqpTNpZBwMbr
lclLLllsQLFlsbMqNrMwTpwpcM
SvbDzSDbWFJfWPPgdnfR
GbpSSbGDNbSSJbDZNZbDppGtMntHLHvHCTLCJMHnRCMLTT
cdwddjBfPsmPPQqQqscnHgRMtngvtjjgCCTMzM
WvwPvWvflBwdQPlNVVhbDGpFhNGhbl
WZRGmRvpCRFTZMQQQMCdddDDcD
lqgqsgvjVtbMDzzbtcDQ
NsNNgjNNjsNhnSvRmnpGRmSTSG
nTgFtDTDDLrFBStdGdcHcbvGSc
QPzfPCMzWCjfMPJhWGlRbRWRWrRRdVVH
zhCrCQCjPrpNNBsNspNnwq
zTJpqFzbTzsWsVbbfLGfSSCDNSBCHfMLHG
rZcvtmhctrvmlPPmmmrhhmBLCHDCCLLDlqMlGMNDMwDC
rRhRhnnQPZhtZcZtdttZgqFWWVjssqQpppWpFpJW
NWPhdWJPWVzVqQrqmSsPbrPP
cZDRjGsffGsCDfffgjGgRQSrTcTmSlTrbnqmSSrlln
fFGCjGCjLDLFRgfDHZvzLVWtvsWWBtzJNWMB
qMVbtnmMMTpCppsR
NffHGrWzWWgDBfTRhChCnSCWcnjT
QrlQBPBrlPHrrQlrHFLqPnLvVvbVmVVJtq
MVMpHMZLVCpMrfWjvWnfrJ
hlblzDDzwlSlGtRhRlSdrfGGWnWWfFPjJjnfqWGF
lmlhBRlDhhhDRRhwDmBpHJmsNCHmCgNHJCJLsc
jvsLgmqLgHvbPPVbNjSCjC
pwTcRpRWLRMLJJFwBBGWcFWNVlDDCSTVttNPblZZCVVDlP
GcdhccpcpRpGRhGmfsHHzLQQHrmsnh
FMmSRgtMltMnVgnmNvlrsJrsZWjspvsZJp
QbdhqwqbNqdHbTdcbcpsrpvjfWfLJLfwJrWp
DQBBQqQGccdTPGqqBNtFGRSMRSFGtnVSnnmM
fPjGrfFrrprprdrbQPZwlcZwZmlJwH
qvNnvWnvWDvSvqNtWSLWStqbcJBQwQJwQZHLBZbcmJbblb
DMtvqSvvDtntCRfwzGCgdzzFjG
TfdZgtmfDgqgvlLFFsFHvcvZ
pphWQMVjQVVBWWjRlHlHnlcLDDhcnF
JQwwWVPBwMJpJwpWwGBWNzrDzSSzfgTPqTSTTtSPgt
"""
