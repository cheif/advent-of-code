import Foundation
import Shared
import Algorithms

private func expand(input: String, size: Int) -> Grid<Character> {
    let grid = Grid(lines: input.split(whereSeparator: \.isNewline).map { $0.map { $0 }})
    var rows: [Int] = []
    var cols: [Int] = []
    for y in grid.yRange {
        let points = grid.xRange.map { x in Position(x: x, y: y) }.map { grid.points[$0]! }
        if points.allSatisfy({ $0.val == "." }) {
            rows.append(y)
        }
    }
    for x in grid.xRange {
        let points = grid.yRange.map { y in Position(x: x, y: y) }.map { grid.points[$0]! }
        if points.allSatisfy({ $0.val == "." }) {
            cols.append(x)
        }
    }
    let expandedData = grid.data.map { point in
        let xExpansion = cols.filter { $0 <= point.x }.count * (size - 1)
        let yExpansion = rows.filter { $0 <= point.y }.count * (size - 1)
        return Grid<Character>.Point(x: point.x + xExpansion, y: point.y + yExpansion, val: point.val)
    }
    return Grid(data: expandedData)
}

public let day11 = Solution(
    part1: { input in
        let expanded = expand(input: input, size: 2)
        let galaxies = expanded.data.filter { $0.val == "#" }
        let pairs = galaxies.combinations(ofCount: 2)
        let distances = pairs.map { $0[0].distance(to: $0[1]) }
        return distances.sum
    },
    part2: { input in
        let expanded = expand(input: input, size: 1_000_000)
        let galaxies = expanded.data.filter { $0.val == "#" }
        let pairs = galaxies.combinations(ofCount: 2)
        let distances = pairs.map { $0[0].distance(to: $0[1]) }
        // 568915165297 incorrect
        return distances.sum
    },
    testResult: (374, 82000210),
    testInput: """
...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....
""",
    input: """
.....................#..........#......#............#........................................#..............................................
#.........................#...................................#...................#.........................................................
......................................................................#......#...................................#..........#...............
........................................................................................................................................#...
......#............................#.......................#................................................................................
........................#......................#.........................................................#..................................
.............#................#.....................#................................#.................................#....................
...............................................................................................................#............................
..........................................#........................#...............................................................#........
#...............................................................................#...............#..................#......#.................
.........#................................................................#..............#............#.....................................
...................................................#........................................................................................
.....#.............#............................................#.........................................#...................#.............
.......................................................................................................................#....................
..........................................#.............#......................................#.......................................#....
..........#..........................#........................................................................#.............................
..........................................................................#..........................#......................................
...#..................#..........................#......................................#...................................................
.................#..........................#....................................................#...........................#.......#......
............................#.................................#.......#...........................................#.........................
.......#.........................................................................#..........................................................
...........................................................................#..........................#...................................#.
...............................................................................................#...............#..................#.........
............................................................................................................................................
.............#...........................................#.....#........................#................................#..................
.#..................................................#...................#...........................#.......#...............................
............................#................................................................#..........................................#...
.........#....................................#.............#....................................................#..........................
...................#...................#............................#.............................................................#.........
.........................#..................................................................................................................
...................................................................................#........................................#...............
.......#...........................................#.........................................................#..............................
..........................................#......................#............#.............#........................................#......
................................#.......................................................................#...................................
....#.................................#..................................................................................................#..
............................#...............................................................................................................
..............#........#.............................................#......................................................................
....................................................#.......#...........................................................#...................
..........#........#...............................................................#..............#.........................................
..............................................#..............................................#..................#...........................
.................................#............................................#...........................#................................#
..#...................................#.............................................................................#................#......
............#.......................................................................................#........................#..............
.................................................#..............#......#.............#......................................................
................................................................................#...........................................................
...........................................#..........#....................................................#......#.........................
........................#.......................................................................................................#...........
..................#...............#...........................................................#.............................................
.....#.....#.......................................#..........................................................#.........................#...
#......................................................................#..................#.........#.......................................
......................#..............#...........................#..........................................................................
..............................#...............#.............#..............................................#.......#........#...............
............................................................................................................................................
..............#.....................................#..................................#...............#..........................#.........
..#........................#................................................................................................................
................................................................#...........................#..................#............................
.........#...................................................................#..........................................#............#......
..................#........................#................................................................................................
.................................................#.......................#......................#.........................................#.
............................................................................................................................................
..#...........#.............#....................................................................................#..........................
.....................#..............................................#.......................................................................
.....................................#.............................................#......#.................#...........................#...
..........................................#..........#..................................................................#...................
........................#........#...............................#.................................#...........................#............
........#.................................................#.................................................................................
............................................................................................................................................
#.................#...................#..........#..................#.....#........................................................#........
............#.................................................................................................#.............................
..........................#.........................................................#.......................................................
...................................#.....................................................#..........#.......................................
............................................#..................#..................................................#.........................
..............#..........................................#............#........................#..........................................#.
......#.................#........................................................#..........................................................
...................................................#.......................................#..................................#.....#.......
.........................................#..................................................................................................
.....................#.........................#......................................#............#.....................#..................
............................#......#.........................................#......................................#.......................
............................................................................................................................................
...........#......................................#.................#.............#.........................................................
.............................................#..........#..................................#..................#.............................
..................#........................................................#............................#.............#.....................
............................................................................................................................................
............................................................................................................................................
.............#.......................#......................................................................................................
....................#......................#................................................#...............................................
........................................................#.............#........#.....................................................#......
.....#........................................................#..........................................#......................#...........
..........#..............#......#.........................................#......................................#..........................
..................................................#.........................................................................................
.#...................................................................................................#.......#.........#.................#..
.....................................#.........................................................#............................................
......................#......................#..................................#...........................................................
..........................................................................................................................#...........#.....
.................................#.........................#........................................................#.......................
...........#....................................................#.......................#..................#....................#..........#
...................................................#.................#......................................................................
#..........................#........#.....................................#.........#..........#............................................
...........................................................................................................................#...........#....
....................#.........................#.................................#...........................................................
.......#............................................................................................#.....#.................................
......................................................#........#........#....................#............................................#.
........................................#...................................................................................................
.........................#.....#...........................#.......#...............#..........................#.............................
.............#..............................#.........................................................................#.....................
.................................................#......................................#...................................................
................................................................................................#...........................................
....................#.............................................................................................................#.........
#.........................................#...................#..............................................#..............................
....................................................................#...........#....................................#......................
..............#........#.......................#......#.....................................#.........#.....................................
.....................................#....................................#...............................................................#.
...................#.......................................#..........................#......................................#..............
........#.....................#.............................................................................................................
.........................#..............................................................................#..........#........................
#...............................................................#.................#.........................................................
.......................................#.............................#............................#.......................#...........#.....
.................................................#..........................................................#..............................#
.........................................................#....................................................................#.............
.........................................................................................#..................................................
......#.........#......#...............................................................................#....................................
...........................................#........................#................#......................................................
............................#.......#.................................................................................#.............#.......
...................#.............................................................................................#..........#...............
...............................................#.........#.........................................#......#.................................
...............................................................................#................................................#...........
...............................................................#....................#........#........................................#.....
.........#........................................#.........................................................................................
.......................................................#................#..........................................#.........#..............
...................................#....................................................#..............#....................................
.................#......................#.....#.............................................................................................
#.......................#.......................................................#..........................................................#
...............................................................................................................#..........#.................
....................#.............................#...........................................#.....#................#......................
.....................................#.....................#.............#............................................................#.....
....#.........#....................................................#........................................................................
.................................................................................#..........................................................
............................#.........................................................................#.....................................
........#............................................#.....................................#.................................#..............
......................#................#...............................#......#............................#................................
"""
)
